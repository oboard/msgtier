///|
test "decode utf8 string" {
  // "Hello!ä½ å¥½ğŸ‘‹"
  // "Hello!" = 6 bytes
  // "ä½ å¥½" = 6 bytes
  // "ğŸ‘‹" = 4 bytes
  // Total 16 bytes.
  // fixstr: 0xa0 | 16 = 0xb0
  let utf8_data = encode(string("Hello!ä½ å¥½ğŸ‘‹"))
  let result = decode(utf8_data)
  match result {
    String(s) => assert_eq(s, "Hello!ä½ å¥½ğŸ‘‹")
    _ => fail("Expected string")
  }
}

///|
test "decode utf8 string in array" {
  let encoded = encode(array([string("å–œæ¬¢ä½ ")]))
  let decoded = decode(encoded)
  match decoded {
    Array(arr) =>
      match arr[0] {
        String(s) => assert_eq(s, "å–œæ¬¢ä½ ")
        _ => fail("Expected string")
      }
    _ => fail("Expected array")
  }
}

///|
test "encode and decode float" {
  let f : Double = 3.14159
  let eps : Double = 0.00001
  let encoded = encode(float64(f))
  let decoded = decode(encoded)
  match decoded {
    Value::Float64(v) => {
      let diff = if v > f { v - f } else { f - v }
      if diff > eps {
        fail("Expected float close to \{f}, got \{v}")
      }
    }
    _ => fail("Expected float")
  }
}
